(this["webpackJsonp@gorgias-chat/client"]=this["webpackJsonp@gorgias-chat/client"]||[]).push([[0],{344:function(e,t,n){"use strict";n.r(t),n.d(t,"FramedMessageWindow",(function(){return Yn}));var a=n(11),r=n(2),i=n(0),o=n.n(i),c=n(85),l=n(43),u=n.n(l),s=n(57),d=n(9),p=n(58),b=n(4),f=n(16),m=n(86),O=n(26),g=n(325),h=n(326),j=n(33);function x(){var e=Object(O.a)(["\n    --focus-color: ",";\n    a:focus {\n        outline-color: var(--focus-color);\n    }\n\n    background: ",";\n    overflow: hidden;\n    z-index: 2;\n    border-radius: 5px;\n    display: flex;\n    flex-direction: column;\n\n    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.15);\n\n    width: ","px;\n    height: ","px;\n\n    position: relative;\n    top: 10px;\n    left: 15px;\n\n    transform: translateY(0);\n\n    animation: ","\n        0.3s ease-in-out;\n\n    &:focus {\n        outline: none;\n    }\n\n    &.widget-xs {\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n\n        border-radius: 0;\n\n        animation: ","\n            0.3s ease-in-out;\n    }\n\n    &.widget-md {\n        width: ","px;\n        height: ","px;\n    }\n\n    &.widget-sm {\n        width: ","px;\n        height: ","px;\n    }\n"]);return x=function(){return e},e}function v(){var e=Object(O.a)(["\n    0% {\n        opacity: 1;\n        transform: translateY(0);\n    }\n    100% {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n"]);return v=function(){return e},e}function y(){var e=Object(O.a)(["\n    0% {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    100% {\n        opacity: 1;\n        transform: translateY(0);\n    }\n"]);return y=function(){return e},e}function w(){var e=Object(O.a)(["\n    margin: 0px 15px 0px 0px;\n    overflow: hidden;\n    user-select: none;\n\n    border: none;\n    border-radius: 5px;\n\n    position: fixed;\n    right: 0;\n    bottom: 90px;\n    top: auto;\n\n    display: ",";\n\n    ","\n\n    z-index: 2147483002;\n"]);return w=function(){return e},e}var E={width:"100%",height:"100%"},C={width:330,height:440},S={width:310,height:390},k={width:385,height:610};var A=Object(j.a)((function(e){e.size,e.shouldRender;var t=Object(m.a)(e,["size","shouldRender"]);return o.a.createElement(u.a,t)}))(w(),(function(e){return e.shouldRender?"block":"none"}),(function(e){return function(e){switch(e){case"xs":return"\n                width: ".concat(E.width," !important;\n                height: ").concat(E.height," !important;\n                left: 0 !important;\n                bottom: 0 !important;\n                top: auto !important;\n                border-radius: 0;\n            ");case"md":return"\n                width: ".concat(C.width+30,"px !important;\n                height: ").concat(C.height+30,"px !important;\n            ");case"sm":return"\n                width: ".concat(S.width+30,"px !important;\n                height: ").concat(S.height+30,"px !important;\n            ");case"lg":default:return"\n                width: ".concat(k.width+30,"px !important;\n                height: ").concat(k.height+30,"px !important;\n            ")}}(e.size)})),T=function(){return Object(r.f)(y())},I=function(){return Object(r.f)(v())},R=j.a.div(x(),(function(e){return Object(d.g)(e.theme.mainColor)}),d.a.White,k.width,k.height,(function(e){return e.isOpen?T():I()}),(function(e){return e.isOpen?T():I()}),C.width,C.height,S.width,S.height),M=n(345);function D(){var e=Object(O.a)(["\n    position: absolute;\n    top: 0.3rem;\n    width: 80%;\n    left: 50%;\n    transform: translateX(-50%);\n    text-align: center;\n    color: black;\n    background: white;\n    padding: 0.3rem 1rem;\n\n    user-select: none;\n    pointer-events: none;\n    opacity: 0;\n\n    z-index: 100;\n\n    &:focus {\n        opacity: 1;\n        outline-color: var(--focus-color);\n    }\n"]);return D=function(){return e},e}var G=j.a.a(D()),N=n(170),L=n.n(N),z=n(6),_=n(75),H=n(93),B=n(78),F=n(71),P=n(10),W=n(122),U=n(63),V=n(5),Z=n(327),Y=n.n(Z),q=n(328),K=n.n(q);function X(){var e=Object(O.a)(["\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    vertical-align: middle;\n    touch-action: manipulation; /* disable the double tap zoom on touch screens */\n    cursor: pointer;\n    border: 1px solid transparent;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis; /* adds '...' when the text is too long */\n    padding: 5px 12px;\n    font-size: 14px;\n    line-height: 1.42857143;\n    background: ",";\n    margin: 0 5px 5px 0;\n    border-radius: 14px;\n    color: ",";\n    border-color: ",";\n    user-select: none;\n\n    &:focus,\n    &:hover {\n        font-weight: bold;\n        outline: none;\n        text-decoration: none;\n        opacity: 0.8;\n        filter: alpha(opacity=80);\n    }\n"]);return X=function(){return e},e}var J=Object(r.d)({display:"flex",flexWrap:"wrap",justifyContent:"center"}),Q=j.a.button(X(),d.a.White,(function(e){return e.theme.mainColor}),(function(e){return e.theme.mainColor})),$=Object(i.memo)((function(e){var t=e.onClick,n=e.shouldDisplay,i=Object(f.b)((function(e){var t,n;return[Object(W.b)(e),null===(t=e.application.settings.quickReplies)||void 0===t?void 0:t.enabled,null===(n=e.application.settings.quickReplies)||void 0===n?void 0:n.replies,e.application.status.historyReceivedCount]})),o=Object(a.a)(i,4),c=o[0],l=o[1],u=o[2],s=o[3];return l&&u&&0!==(null===u||void 0===u?void 0:u.length)&&(!0===n||function(e,t){if(!e)return!1;if(0===t.length)return!0;var n=K()(t,(function(e){var t=e.type===V.a.CONVERSATION_MESSAGE&&Y()(e.id),n=e.type===V.a.PENDING_CONVERSATION_MESSAGE;return t||n}));return void 0===n||n.type!==V.a.PENDING_CONVERSATION_MESSAGE&&!(n.type!==V.a.CONVERSATION_MESSAGE||!(null===n||void 0===n?void 0:n.createdDatetime)||!Object(U.b)().subtract(24,"hour").isAfter(null===n||void 0===n?void 0:n.createdDatetime))}(1===s,c))?Object(r.e)("div",{css:J},u.map((function(e){return Object(r.e)(Q,{"aria-label":'Send "'.concat(e,'" message'),key:e,onClick:t(e)},e)}))):null})),ee=n(14),te=n(346);function ne(){var e=Object(O.a)(["\n    position: absolute;\n    width: 90%;\n    z-index: 1;\n    margin: 8px auto 0 auto;\n    left: 0;\n    right: 0;\n    border-radius: 14px;\n    font-size: 14px;\n    --focus-color: ",";\n    button.close:focus {\n        outline: none;\n        box-shadow: 0 0 0 3px var(--focus-color);\n        border-radius: 10px;\n    }\n"]);return ne=function(){return e},e}var ae=Object(j.a)(te.a)(ne(),(function(e){return Object(d.g)(e.theme.mainColor)})),re=Object(i.memo)((function(){var e=Object(f.a)(),t=Object(f.b)((function(e){return e.application.status.messageBanner})),n=Object(i.useState)(t),r=Object(a.a)(n,2),c=r[0],l=r[1];Object(i.useEffect)((function(){l((function(e){return Object(ee.a)({},e,{isOpen:!1})})),t.isOpen&&setTimeout((function(){l(t)}),200)}),[t]);return o.a.createElement(ae,{color:c.type,isOpen:c.isOpen,toggle:function(){c.isOpen&&e(Object(b.a)(c.category))},timeout:200},c.text)})),ie=n(125);function oe(){var e=Object(O.a)(["\n    display: inline-block;\n"]);return oe=function(){return e},e}var ce=j.a.div(oe());function le(){return(le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function ue(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var se=o.a.createElement("path",{d:"M1.84849 10.388L1.10628 10.2802L1.84849 10.388ZM26.1515 10.388L26.8937 10.2802L26.8937 10.2802L26.1515 10.388ZM25.75 14.5C25.75 20.9893 20.4893 26.25 14 26.25V27.75C21.3178 27.75 27.25 21.8178 27.25 14.5H25.75ZM14 26.25C7.51065 26.25 2.25 20.9893 2.25 14.5H0.75C0.75 21.8178 6.68223 27.75 14 27.75V26.25ZM2.25 14.5C2.25 13.5323 2.36641 12.0402 2.59071 10.4958L1.10628 10.2802C0.874978 11.8729 0.75 13.44 0.75 14.5H2.25ZM25.4093 10.4958C25.6336 12.0402 25.75 13.5323 25.75 14.5H27.25C27.25 13.44 27.125 11.8729 26.8937 10.2802L25.4093 10.4958ZM8.93465 5.75H19.0654V4.25H8.93465V5.75ZM26.8937 10.2802C26.3229 6.34987 22.7999 4.25 19.0654 4.25V5.75C22.3041 5.75 24.9779 7.52525 25.4093 10.4958L26.8937 10.2802ZM2.59071 10.4958C3.02212 7.52525 5.69593 5.75 8.93465 5.75V4.25C5.20009 4.25 1.67709 6.34987 1.10628 10.2802L2.59071 10.4958Z",fill:"white"}),de=o.a.createElement("path",{d:"M9.99827 19.4394C9.68869 19.1643 9.21463 19.1921 8.93944 19.5017C8.66425 19.8113 8.69214 20.2854 9.00173 20.5606L9.99827 19.4394ZM9.90918 20.3234L9.47528 20.9351L9.47528 20.9351L9.90918 20.3234ZM18.0908 20.3234L18.5247 20.9351L18.5247 20.9351L18.0908 20.3234ZM18.9983 20.5606C19.3079 20.2854 19.3357 19.8113 19.0606 19.5017C18.7854 19.1921 18.3113 19.1643 18.0017 19.4394L18.9983 20.5606ZM9.00173 20.5606C9.15158 20.6938 9.31083 20.8185 9.47528 20.9351L10.3431 19.7116C10.217 19.6222 10.1016 19.5313 9.99827 19.4394L9.00173 20.5606ZM18.5247 20.9351C18.6892 20.8185 18.8484 20.6938 18.9983 20.5606L18.0017 19.4394C17.8984 19.5313 17.783 19.6222 17.6569 19.7116L18.5247 20.9351ZM9.47528 20.9351C12.1228 22.813 15.8772 22.813 18.5247 20.9351L17.6569 19.7116C15.5292 21.2208 12.4708 21.2208 10.3431 19.7116L9.47528 20.9351Z",fill:"white"}),pe=o.a.createElement("rect",{width:17,height:4,rx:2,transform:"matrix(1 0 0 -1 5.5 14)",stroke:"white",strokeWidth:1.5}),be=o.a.createElement("path",{d:"M11.5 0.25C11.0858 0.25 10.75 0.585786 10.75 1C10.75 1.41421 11.0858 1.75 11.5 1.75V0.25ZM16.5 1.75C16.9142 1.75 17.25 1.41421 17.25 1C17.25 0.585786 16.9142 0.25 16.5 0.25V1.75ZM11.5 1.75H16.5V0.25H11.5V1.75Z",fill:"white"}),fe=function(e){var t=e.svgRef,n=e.title,a=ue(e,["svgRef","title"]);return o.a.createElement("svg",le({width:25,height:25,viewBox:"0 0 28 28",fill:"none",ref:t},a),n?o.a.createElement("title",null,n):null,se,de,pe,be)},me=o.a.forwardRef((function(e,t){return o.a.createElement(fe,le({svgRef:t},e))})),Oe=(n.p,n(126));function ge(){var e=Object(O.a)(["\n    label: AvatarBotWrapper;\n\n    background: ",";\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n"]);return ge=function(){return e},e}function he(){var e=Object(O.a)(["\n    label: AvatarWrapper;\n    border-radius: 100%;\n    width: 35px;\n    height: 35px;\n    margin-right: 9px;\n    margin-top: 0;\n    vertical-align: top;\n    display: inline-block;\n    opacity: ",";\n\n    img {\n        width: 35px;\n        height: 35px;\n        border-radius: 50%;\n        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.05);\n    }\n"]);return he=function(){return e},e}var je=j.a.div(he(),(function(e){return e.isFirstInGroup?1:0})),xe=Object(j.a)(je)(ge(),d.a.MediumDarkGrey),ve=function(e){var t=e.avatarURL,n=e.name,a=e.isFirstInGroup;return e.isBot?o.a.createElement(xe,{isFirstInGroup:a,"aria-hidden":!a},o.a.createElement(me,null)):o.a.createElement(je,{isFirstInGroup:a,"aria-hidden":!a},t?o.a.createElement("img",{alt:"".concat(n," profile"),src:t}):o.a.createElement(Oe.a,{name:n}))};function ye(){var e=Object(O.a)(["\n    padding: 15px 20px 0;\n    width: 100%;\n    flex-grow: 1;\n    border-bottom: 1px solid transparent;\n    box-sizing: border-box;\n"]);return ye=function(){return e},e}function we(){var e=Object(O.a)(["\n    position: relative;\n    margin-right: 2px;\n    transition: padding-top 0.5s;\n    display: flex;\n    flex: 1;\n    flex-direction: column;\n"]);return we=function(){return e},e}function Ee(){var e=Object(O.a)(["\n    overflow-y: auto;\n    overflow-x: hidden;\n    overscroll-behavior: contain;\n    display: flex;\n    flex: 1;\n    flex-direction: column;\n"]);return Ee=function(){return e},e}var Ce,Se=j.a.div(Ee()),ke=j.a.div(we()),Ae=(Object(r.d)({lineHeight:"15px",marginBottom:"12px",textAlign:"center",a:{fontSize:"12px",color:d.a.Grey,textDecoration:"none"}}),Object(r.d)({width:"100%",textAlign:"center",textTransform:"uppercase",fontSize:"12px",lineHeight:"15px",letterSpacing:"0.05em",color:d.a.Grey,marginTop:"24px",marginBottom:"24px"})),Te=j.a.div(ye()),Ie=Object(r.d)({display:"flex",flexDirection:"column",marginBottom:"6px"}),Re=function(e){return Object(r.d)({display:"flex",flexDirection:"row",marginTop:e?"20px":0,marginBottom:"6px"})},Me=Object(r.d)({whiteSpace:"nowrap",fontWeight:500,fontSize:d.f.senderName,color:d.a.DarkGrey,lineHeight:"16px",marginBottom:"6px"}),De=Object(r.d)({width:"44px",minHeight:"1px",marginRight:"6px"}),Ge=Object(r.d)({display:"inline-block",borderRadius:"14px",padding:"3px",maxWidth:"100%",overflowWrap:"break-word",color:d.a.White}),Ne=Object(r.d)(Ge,{background:d.a.VeryLightGrey,boxShadow:"0px 1px 1px rgba(0, 0, 0, 0.05)",color:d.a.DarkGrey}),Le=Object(r.d)(Ne,{borderTopLeftRadius:"0px",marginTop:"2px"}),ze=Object(r.d)({padding:"8px 13px",whiteSpace:"pre-line",fontWeight:400,fontSize:d.f.message,fontRendering:"optimizelegibility",wordBreak:"break-word"}),_e=Object(r.d)({fontWeight:400,fontSize:"12px",color:d.a.Grey,marginTop:"5px",padding:0,lineHeight:"20px",backgroundColor:"transparent",border:"none",outline:"none",display:"flex",alignSelf:"flex-end",svg:{marginRight:"6px"},":focus, :active":{outline:"none"}}),He=Object(r.d)(_e,{textAlign:"right"}),Be=Object(r.d)([Le,{marginLeft:"-100px",opacity:"0.1",transition:"margin-left .25s cubic-bezier(.55,0,.1,1) .3s,\n    \topacity .25s cubic-bezier(.55,0,.1,1) .3s"}]),Fe=Object(r.d)({marginLeft:0,opacity:1}),Pe=Object(r.d)(ze,{height:"18px"});!function(e){e.TEXT="text",e.ATTACHMENTS="attachments",e.OPTIONAL_EMAIL_CAPTURE_FORM="optional-email-capture-form"}(Ce||(Ce={}));var We=n(17),Ue=n.n(We);function Ve(){var e=Object(O.a)(["\n    --balloon-font-size: 12px;\n    --balloon-border-radius: 4px;\n    --balloon-color: #333;\n"]);return Ve=function(){return e},e}var Ze=j.a.div(Ve()),Ye=Object(i.memo)((function(e){var t=e.content,n=e.placement,a=e.disabled,o=e.children;return a?Object(r.e)(i.Fragment,null,o):Object(r.e)(Ze,{"data-balloon-blunt":!0,"data-balloon-content":t,"data-balloon-pos":n},o)}));function qe(){var e=Object(O.a)(["\n    max-width: 100%;\n    display: block;\n    cursor: pointer;\n"]);return qe=function(){return e},e}var Ke=j.a.img(qe()),Xe=Object(i.memo)((function(e){var t=e.alt,n=e.url,r=e.className,c=Object(i.useState)(!1),l=Object(a.a)(c,2),u=l[0],s=l[1],d=Object(i.useRef)(new Image),p=Object(i.useRef)(null),b=Object(i.useRef)(!1),m=Object(B.b)().scrollToBottomSmooth,O=Object(f.b)((function(e){return[1===e.application.status.historyReceivedCount,Object(W.b)(e),e.application.status.isScrolledUp]})),g=Object(a.a)(O,3),h=g[0],j=g[1],x=g[2],v=j[j.length-1],y=Ue()(v,["content","attachments"],[]).find((function(e){return Ue()(e,"url")===n}));return Object(i.useEffect)((function(){d.current&&!u&&(d.current.src=n,d.current.onload=function(){s(!0)},y||setTimeout((function(){b.current=!0}),2e3))}),[n,u,y]),Object(i.useEffect)((function(){!b.current&&!y&&u&&h&&m&&(b.current=!0,m())}),[m,u,y,h]),Object(i.useEffect)((function(){if(u&&!b.current&&y){if(v.fromAgent&&x)return void(b.current=!0);m&&(b.current=!0,m(100))}}),[m,u,y,v,x,n]),o.a.createElement(Ke,{hide:!u||!d.current,ref:p,alt:t,className:r,src:n})}));function Je(){var e=Object(O.a)(["\n    cursor: pointer;\n    right: ",";\n    left: ",";\n    background-color: transparent;\n    border: none;\n    border-radius: ",";\n    padding: 0;\n    margin: 0;\n    overflow: hidden;\n\n    &:focus {\n        outline: none;\n        box-shadow: 0 0 0 4px var(--focus-color);\n    }\n"]);return Je=function(){return e},e}function Qe(){var e=Object(O.a)(["\n    display: flex;\n    justify-content: ",";\n    align-items: flex-start;\n    margin-top: 4px;\n    margin-bottom: 4px;\n"]);return Qe=function(){return e},e}var $e=Object(r.d)({width:"100%",p:{margin:0,wordBreak:"break-word"}}),et=function(e,t){var n=Object(r.d)($e,{".attachment-content-image-container":{button:{borderRadius:"14px"}}});if(t){var a=e?{borderTopLeftRadius:0}:{borderTopRightRadius:0};return Object(r.d)(n,{".attachment-content-image-container":{button:a}})}return n},tt=j.a.div(Qe(),(function(e){return e.fromAgent?"flex-start":"flex-end"}));tt.defaultProps={className:"attachment-content-image-container"};var nt=j.a.button(Je(),(function(e){return e.fromAgent?"auto":0}),(function(e){return e.fromAgent?0:"auto"}),(function(e){return e.withText?"6px":"14px"}));nt.defaultProps={type:"button"};var at=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return 0===e.length?null:t||n!==V.a.PENDING_CONVERSATION_MESSAGE?e.map((function(e,n){var i=e.url,o=e.contentType,c=i.split("/").pop();return o.startsWith("image/")?Object(r.e)(tt,{"data-testid":"attachment-content-image-container",key:"".concat(i,"-").concat(n),fromAgent:t},Object(r.e)(nt,{fromAgent:t,withText:a,onClick:function(){return window.open(i)}},Object(r.e)(Xe,{alt:"image attachment",url:i,role:"button"}))):o?Object(r.e)("a",{"data-testid":"file attachment","aria-label":"Link to a ".concat(o.split("/")[1]?o.split("/")[1]:""," file"),href:i,onClick:function(e){e.preventDefault(),window.open(i)},key:i},c):null})):null},rt=Object(i.memo)((function(e){var t=e.content,n=e.createdDatetime,a=e.isFirstInGroup,i=e.fromAgent,o=e.typeOfMessage,c=t.text,l=void 0===c?null:c,u=t.attachments,s=Object(U.b)(n).format("hh:mm A"),d=i?"up-left":"up-right";return function(e){return!(!e.attachments||!Array.isArray(e.attachments))&&(1===e.attachments.length&&0===e.attachments[0].contentType.indexOf("image/")&&!e.text)}(t)?Object(r.e)(Ye,{placement:d,content:s,disabled:!n},Object(r.e)("div",{css:et(i,a),"data-testid":"attachment-content-component"},l&&Object(r.e)("p",null,l),at(u,i,o,Boolean(l)))):i?Object(r.e)("div",{css:a?Le:Ne},Object(r.e)("div",{css:ze},Object(r.e)(Ye,{placement:d,content:s,disabled:!n},Object(r.e)("div",{css:$e,"data-testid":"attachment-content-component"},l&&Object(r.e)("p",null,l),at(u,i,o,Boolean(l)))))):null})),it=n(69),ot=Object(i.memo)((function(e){var t=e.text,n=e.isFirstInGroup,a=e.createdDatetime,o=e.fromAgent,c=e.typeOfMessage,l=Object(it.b)(),u=Object(f.b)((function(e){return e.application.status.isChatOnline})),s=Object(i.useMemo)((function(){return c!==V.a.CONVERSATION_MESSAGE?u?l.pendingConversationColor:l.offlinePendingConversationColor:u?l.conversationColor:l.offlineColor}),[c,u,l]),d=Object(U.b)(a).format("hh:mm A");return o?Object(r.e)("div",{css:n?Le:Ne},Object(r.e)(Ye,{placement:"down-left",content:d,disabled:!a},Object(r.e)("div",{css:ze},t))):Object(r.e)("div",{css:Ge,style:Object.assign({backgroundColor:s},n?{borderTopRightRadius:"0px",marginTop:"12px"}:{})},Object(r.e)(Ye,{placement:"down-right",content:d,disabled:c!==V.a.CONVERSATION_MESSAGE},Object(r.e)("div",{css:ze},t)))})),ct=function(e){var t=e.createdDatetime,n=e.isFirstInGroup,r=e.fromAgent,i=e.typeOfMessage,c=Object(f.b)((function(e){return[e.application.texts,e.application.status.isChatOnline]})),l=Object(a.a)(c,2),u=l[0],s=l[1]?u.emailCaptureOnlineTriggerText:u.emailCaptureOfflineTriggerText;return o.a.createElement(ot,{text:s,createdDatetime:t,isFirstInGroup:n,fromAgent:r,typeOfMessage:i})},lt=function(e){var t=e.content,n=e.createdDatetime,a=e.isFirstInGroup,i=e.fromAgent,o=e.typeOfMessage;switch(function(e){return"type"in e&&e.type?e.type:"attachments"in e&&e.attachments.length>0?Ce.ATTACHMENTS:Ce.TEXT}(t)){case Ce.ATTACHMENTS:return Object(r.e)(rt,{content:t,createdDatetime:n,isFirstInGroup:a,fromAgent:i,typeOfMessage:o});case Ce.OPTIONAL_EMAIL_CAPTURE_FORM:return Object(r.e)(ct,{createdDatetime:n,isFirstInGroup:a,fromAgent:i,typeOfMessage:o});case Ce.TEXT:default:var c=Ue()(t,"text","");return Object(r.e)(ot,{text:c,createdDatetime:n,isFirstInGroup:a,fromAgent:i,typeOfMessage:o})}},ut=n(15),st=n.n(ut),dt=n(28),pt=n(155),bt=function(e,t){var n=Object(U.b)(e);return n>Object(U.b)().subtract(1,"minute")?t.messageRelativeTimeJustNow:n>Object(U.b)().subtract(1,"hour")?t.messageRelativeTimeMinute.replace("{value}",Math.floor(Object(U.b)().diff(n,"minute")).toString()):n>Object(U.b)().subtract(1,"day")?t.messageRelativeTimeHour.replace("{value}",Math.floor(Object(U.b)().diff(n,"hour")).toString()):t.messageRelativeTimeDay.replace("{value}",Math.floor(Object(U.b)().diff(n,"day")).toString())},ft=Object(i.memo)((function(e){var t=e.id,n=e.typeOfMessage,o=e.createdDatetime,c=Object(i.useState)(!1),l=Object(a.a)(c,2),u=l[0],s=l[1],d=Object(i.useState)(!1),p=Object(a.a)(d,2),b=p[0],m=p[1],O=Object(f.a)(),g=Object(f.b)((function(e){var t=e.application,n=t.status,a=t.texts;return[n.isConnected,n.initializedSocket,n.historyStatus,a]})),h=Object(a.a)(g,4),j=h[0],x=h[1],v=h[2],y=h[3],w=Object(i.useMemo)((function(){return!(x&&!j||u)}),[x,j,u]);Object(i.useEffect)((function(){x&&b&&(m((function(){return!1})),s((function(){return!0})))}),[x,b]),Object(i.useEffect)((function(){u&&v===P.f.SUCCESS&&(O(Object(_.a)({id:t})),s((function(){return!1})))}),[u,v,O,t]);var E=Object(i.useCallback)(function(){var e=Object(dt.a)(st.a.mark((function e(n){return st.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),x||(O(Object(pt.a)()),m(!0)),j&&O(Object(_.a)({id:t}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[j,O,t,x]);return n===V.a.CONVERSATION_MESSAGE||n===V.a.PENDING_CONVERSATION_MESSAGE?Object(r.e)("div",{css:He},Object(r.e)("span",{className:"sr-only"},","),o?bt(o,y):y.messageSending):Object(r.e)("button",{type:"button",css:He,style:w?{cursor:"pointer"}:{},onClick:E},Object(r.e)("span",{style:{color:"#FFC600",marginRight:"4px"},role:"img","aria-label":"Warning emoji"},"\u26a0\ufe0f"),"Message not delivered. ",w&&Object(r.e)("span",{style:{fontWeight:"bold",marginLeft:"4px"}},"Click to retry"))})),mt=n(8);function Ot(){var e=Object(O.a)(["\n    display: inline-block;\n    font-size: 12px;\n    line-height: 14px;\n    margin-top: 6px;\n    color: ",";\n"]);return Ot=function(){return e},e}function gt(){var e=Object(O.a)(["\n    box-sizing: border-box;\n    width: 40px;\n    background: ",";\n    border: 1px solid rgba(0, 0, 0, 0.1);\n    color: white;\n    opacity: 0.9;\n    transition: all 0.1s linear;\n    border-radius: 0 3px 3px 0;\n\n    &:hover {\n        opacity: 1;\n    }\n\n    &:focus {\n        outline: none;\n        border-color: white;\n        i {\n            transform-origin: center;\n            transform: scale(1.3);\n        }\n    }\n"]);return gt=function(){return e},e}function ht(){var e=Object(O.a)(["\n    box-sizing: border-box;\n    flex: 1;\n    border: 1px solid #c3c8d0;\n    border-right: none;\n    border-radius: 3px 0 0 3px;\n    padding-left: 13px;\n\n    transition: border 0.1s linear;\n\n    &:hover,\n    &:focus {\n        border-color: ",";\n    }\n\n    &:focus {\n        outline: none;\n    }\n"]);return ht=function(){return e},e}function jt(){var e=Object(O.a)(["\n    display: flex;\n    margin-top: 13px;\n    height: 40px;\n"]);return jt=function(){return e},e}function xt(){var e=Object(O.a)(["\n    font-size: 14px;\n    line-height: 17px;\n    font-weight: 600;\n    color: ",";\n"]);return xt=function(){return e},e}var vt,yt=function(e,t){return Object(r.d)(ze,{label:"optional-email-capture",marginTop:e?"10px":"15px",padding:"15px",background:e?d.a.LightGreen:d.a.VeryLightGrey,border:"1px solid ".concat(e?"rgba(36, 214, 157, 0.15)":"rgba(0, 0, 0, 0.05)"),boxShadow:"0px 2px 5px rgba(0, 0, 0, 0.1)",borderRadius:"14px",transition:"all linear 0.1s",opacity:t?.5:1})},wt=j.a.span(xt(),d.a.DarkGrey),Et=j.a.form(jt()),Ct=j.a.input(ht(),(function(e){return e.theme.mainColor})),St=j.a.button(gt(),(function(e){return e.theme.mainColor})),kt=j.a.span(Ot(),d.a.Red);function At(){var e=Object(O.a)(["\n    font-family: FontAwesome;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-font-smoothing: antialiased;\n    display: inline-block;\n    font-style: normal;\n    font-variant: normal;\n    text-rendering: auto;\n    line-height: 1;\n    font-weight: 900;\n\n    &:before {\n        content: ",";\n    }\n"]);return At=function(){return e},e}!function(e){e.PLANE='"\f1d8"',e.CAMERA='"\f030"',e.CHEVRON_RIGHT='"\f054"',e.CHECK='"\f00c"',e.CHECK_CIRCLE='"\f058"',e.WARNING='"\f071"',e.ANGLE_RIGHT='"\f105"',e.FA_ANGLE_DOWN='"\f107"',e.FA_ANGLE_UP='"\f106"',e.FA_EXTERNAL_LINK='"\f0c1"'}(vt||(vt={}));var Tt=j.a.i(At(),(function(e){return e.code}));function It(){var e=Object(O.a)(["\n    display: flex;\n    align-items: center;\n    font-size: 14px;\n    line-height: 20px;\n    color: ",";\n\n    i {\n        margin-right: 11px;\n    }\n\n    span {\n        font-weight: bold;\n    }\n"]);return It=function(){return e},e}Tt.defaultProps={"aria-hidden":!0};var Rt=j.a.div(It(),d.a.DarkGreen),Mt=function(){var e=Object(f.b)((function(e){return[e.application.texts.emailCaptureOfflineThanksText,e.application.texts.emailCaptureOnlineThanksText,e.application.status.isChatOnline,e.user.email]})),t=Object(a.a)(e,4),n=t[0],r=t[1],i=t[2],c=t[3],l=i?r.split("{email}"):n.split("{email}"),u=Object(a.a)(l,2),s=u[0],d=u[1];return Boolean(c)?o.a.createElement(Rt,{tabIndex:-1},o.a.createElement(Tt,{code:vt.CHECK}),o.a.createElement("p",null,"".concat(s," "),o.a.createElement("span",null,c)," ".concat(d))):null},Dt=function(e){var t=e.email,n=e.hasError,r=e.isLoading,c=e.onChange,l=e.onSubmit,u=Object(f.b)((function(e){return[e.application.texts.emailCaptureInputLabel,e.application.texts.actionPostbackError]})),s=Object(a.a)(u,2),d=s[0],p=s[1],b=o.a.useRef(null);return o.a.createElement(i.Fragment,null,o.a.createElement(wt,null,d),o.a.createElement(Et,{onSubmit:function(e){var n;e.preventDefault(),t.trim()&&(null===(n=b.current)||void 0===n?void 0:n.reportValidity())&&l(e)}},o.a.createElement(Ct,{value:t,"aria-label":"Provide your email to be notified",placeholder:"youremail@gmail.com",onChange:c,type:"email",name:"email",pattern:"^[\\w\\-\\+=']+[\\w\\.\\-\\+=']*@[\\w\\.\\-]+\\.\\w+$",disabled:r,maxLength:320,ref:b,required:!0}),o.a.createElement(St,{type:"submit",disabled:r,"aria-label":"Submit your email"},o.a.createElement(Tt,{code:vt.CHEVRON_RIGHT}))),n?o.a.createElement(kt,null,p):null)},Gt=function(){var e=Object(f.a)(),t=Object(f.b)((function(e){return e.user.email})),n=Object(i.useState)(!1),o=Object(a.a)(n,2),c=o[0],l=o[1],u=Object(i.useState)(""),s=Object(a.a)(u,2),d=s[0],p=s[1],b=Object(i.useState)(!1),m=Object(a.a)(b,2),O=m[0],g=m[1],h=Object(i.useRef)(null);Object(i.useEffect)((function(){c&&null===h.current&&(h.current=setTimeout((function(){c&&!t&&(l(!1),g(!0))}),5e3)),c&&t&&(null!==h.current&&(clearTimeout(h.current),h.current=null),l(!1)),c||null===h.current||clearTimeout(h.current)}),[t,c]);var j=Object(i.useCallback)((function(e){p(e.target.value)}),[]);return Object(r.e)("div",{css:yt(Boolean(t),c)},t?Object(r.e)(Mt,null):Object(r.e)(Dt,{hasError:O,email:d,isLoading:c,onChange:j,onSubmit:function(t){t.preventDefault(),mt.a.addBreadcrumb({message:"User tried to submit an email",data:{email:d}}),g(!1),h.current=null,e(Object(_.c)(d)),l(!0)}}))},Nt=function(e){var t,n=e.content;return t=n,Ue()(t,"type","")===Ce.OPTIONAL_EMAIL_CAPTURE_FORM?o.a.createElement(Gt,null):null},Lt=Object(i.memo)((function(e){var t=e.id,n=e.isFirstInGroup,a=e.showStatusIndicator,i=e.content,o=e.createdDatetime,c=e.senderInfo,l=e.typeOfMessage,u=(null===c||void 0===c?void 0:c.name)?c.name:"Agent",s=Object(U.b)(o).format("h:mm A");return Object(r.e)("div",{css:Re(n),tabIndex:-1},Object(r.e)("div",{"aria-hidden":"true",css:De},Object(r.e)(ve,{isFirstInGroup:n,avatarURL:null===c||void 0===c?void 0:c.avatarURL,name:null===c||void 0===c?void 0:c.name,isBot:Boolean(null===c||void 0===c?void 0:c.isBot)})),Object(r.e)(ce,null,n&&Object(r.e)("div",{"aria-hidden":"true",css:Me},null===c||void 0===c?void 0:c.name),Object(r.e)("span",{className:"sr-only"},"".concat(s,". ").concat(u," says:")),Object(r.e)(lt,{content:i,createdDatetime:o,fromAgent:!0,isFirstInGroup:n,typeOfMessage:l}),Object(r.e)(Nt,{content:i}),a&&Object(r.e)(ft,{createdDatetime:o,id:t,typeOfMessage:V.a.CONVERSATION_MESSAGE})))})),zt=Object(i.memo)((function(e){var t=e.id,n=e.showStatusIndicator,a=e.content,i=e.isFirstInGroup,o=e.createdDatetime,c=e.typeOfMessage,l=Object(U.b)(o).format("h:mm A");return Object(r.e)("div",{css:Ie,tabIndex:-1},Object(r.e)("div",{css:{width:"100%",display:"flex",flexDirection:"row-reverse"}},Object(r.e)("span",{className:"sr-only"},"".concat(l,". You say:")),Object(r.e)(lt,{content:a,createdDatetime:o,fromAgent:!1,isFirstInGroup:i,typeOfMessage:c})),n&&Object(r.e)(ft,{createdDatetime:o,id:t,typeOfMessage:c}))})),_t=Object(i.memo)((function(e){var t=e.id,n=e.showStatusIndicator,i=e.typeOfMessage,o=e.isFirstInDay,c=e.isFirstInGroup,l=e.timestamp,u=e.fromAgent,s=e.senderInfo,d=e.content,p=e.createdDatetime,b=Object(f.b)((function(e){return[e.application.settings.language,e.application.texts]})),m=Object(a.a)(b,2),O=m[0],g=m[1],h=new Date(l).getTime()>(new Date).getTime()-5e3;return Object(r.e)("div",{"aria-live":h?"assertive":"off"},o&&Object(r.e)("h3",{key:"first_in_day_".concat(t),css:Ae},Object(U.b)(l).locale(Object(U.d)(O)).format(g.conversationTimestampHeaderFormat)),u?Object(r.e)(Lt,{id:t,showStatusIndicator:n,isFirstInGroup:c,content:d,createdDatetime:p,senderInfo:s,typeOfMessage:i}):Object(r.e)(zt,{id:t,showStatusIndicator:n,isFirstInGroup:c,typeOfMessage:i,content:d,createdDatetime:p}))}));function Ht(){var e=Object(O.a)(["\n    0% { transform: scale(1); }\n    50% { transform: scale(1.05); }\n"]);return Ht=function(){return e},e}function Bt(){var e=Object(O.a)(["\n    50% { opacity: 1 }\n"]);return Bt=function(){return e},e}var Ft=Object(r.f)(Bt()),Pt=Object(r.f)(Ht()),Wt=Object(r.d)({display:"flex",justifyContent:"center",alignItems:"center","> span:first-of-type":{animation:"1s ".concat(Ft," infinite .3333s")},"> span:nth-of-type(2)":{animation:"1s ".concat(Ft," infinite .6666s")},"> span:nth-of-type(3)":{animation:"1s ".concat(Ft," infinite .9999s")},boxSizing:"content-box"}),Ut=Object(r.d)({float:"left",display:"inline-block",height:"6px",width:"6px",margin:"0 2px",borderRadius:"50%",backgroundColor:d.a.MediumDarkGrey,opacity:"0.4",animation:"2s ".concat(Pt," infinite ease-out")}),Vt=function(e){var t=e.className;return Object(r.e)("div",{className:t,css:Wt},Object(r.e)("span",{"data-testid":"typingIndicator-dot",css:Ut}),Object(r.e)("span",{"data-testid":"typingIndicator-dot",css:Ut}),Object(r.e)("span",{"data-testid":"typingIndicator-dot",css:Ut}))},Zt=Object(i.memo)((function(){var e=Object(i.useState)(Be),t=Object(a.a)(e,2),n=t[0],o=t[1];return Object(i.useEffect)((function(){o([Be,Fe])}),[]),Object(r.e)("div",{css:Re(!1)},Object(r.e)("div",{css:De}),Object(r.e)(ce,null,Object(r.e)("div",{css:n,"aria-live":"polite","aria-label":"Agent is typing"},Object(r.e)(Vt,{css:Pe}))))})),Yt=Object(i.memo)((function(){var e=Object(f.b)((function(e){return[Object(W.b)(e),e.conversation.agentTyping,e.application.status.isScrolledUp]})),t=Object(a.a)(e,3),n=t[0],o=t[1],c=t[2],l=Object(B.b)(),u=l.scrollToBottomSmooth,s=l.scrollHistory,d=Object(i.useRef)(0),p=Object(i.useRef)();Object(i.useLayoutEffect)((function(){if(n.length!==d.current){if(n.length>0){var e=n.length>1?n.length-1:0,t=n[e];p.current&&t.createdDatetime?t.createdDatetime!==p.current?(u&&!c&&u(),p.current=t.createdDatetime):s&&s():(u&&u(),p.current=t.createdDatetime)}d.current=n.length}}),[n,s,u,c]),Object(i.useEffect)((function(){u&&o&&!c&&u()}),[u,o,c]);var b=Object(i.useMemo)((function(){return n.filter((function(e,t){var a=e.timestamp;return Object(U.b)(a).dayOfYear()!==(t>0?Object(U.b)(n[t-1].timestamp).dayOfYear():-1)})).map((function(e){return e.id}))}),[n]),m=Object(i.useMemo)((function(){return n.filter((function(e,t){var a,r=e.fromAgent,i=e.senderInfo;if(0===t)return!0;var o=n[t-1],c=r!==o.fromAgent,l=r&&(null===i||void 0===i?void 0:i.name)!==(null===(a=o.senderInfo)||void 0===a?void 0:a.name);return c||l})).map((function(e){return e.id}))}),[n]),O=Object(i.useMemo)((function(){return n.map((function(e,t){var a=e.id,i=e.type,o=e.timestamp,c=e.createdDatetime,l=e.senderInfo,u=e.updatedDatetime,s=e.deletedDatetime,d=e.fromAgent,p=e.content;return Object(r.e)(_t,{key:a,id:a.toString(),showStatusIndicator:i===V.a.CONVERSATION_MESSAGE&&t===n.length-1||i!==V.a.CONVERSATION_MESSAGE,timestamp:o,isFirstInDay:b.includes(a),isFirstInGroup:m.includes(a),typeOfMessage:i,createdDatetime:c,senderInfo:l,updatedDatetime:u,deletedDatetime:s,fromAgent:d,content:p})}))}),[n,m,b]);return Object(r.e)(Te,null,O,o&&Object(r.e)(Zt,null))}));function qt(){var e=Object(O.a)(["\n    margin: 0 auto;\n    width: 90%;\n    font-size: 12px;\n    padding: 0.6rem 0;\n    color: ",";\n    text-align: center;\n"]);return qt=function(){return e},e}var Kt=j.a.div(qt(),d.a.Grey),Xt=Object(i.memo)((function(){var e=Object(f.b)((function(e){var t=e.application,n=t.status,a=t.texts;return[n.historyStatus,a]})),t=Object(a.a)(e,2),n=t[0],i=t[1];return n===P.f.PENDING?Object(r.e)(Kt,{"aria-live":"polite",role:"status"},i.fetchingHistory):n===P.f.SUCCESS?Object(r.e)("span",{className:"sr-only","aria-live":"polite",role:"status"},"History has been fetched"):n===P.f.FAILED?Object(r.e)(Kt,{"aria-live":"assertive",role:"alert"},i.actionPostbackError):null}));var Jt=Object(i.memo)((function(){var e=Object(f.a)(),t=Object(i.useRef)(!1),n=Object(B.b)(),o=n.conversationRef,c=n.preHistoryScrollBottomDistance,l=n.scrollToBottomSmooth,u=Object(f.b)((function(e){return[e.application.status.isScrolledUp,e.application.status.isWindowOpened,e.application.status.historyComplete,e.application.status.wsRetryCount,e.conversation.unseenMessages]})),s=Object(a.a)(u,5),d=s[0],p=s[1],m=s[2],O=s[3],g=s[4];Object(i.useEffect)((function(){p&&!d&&g>0&&(e(Object(z.m)(0)),l&&l())}),[l,e,d,p,g]);var h=Object(i.useCallback)(L()((function(){!function(e,t,n,a){e&&a&&e.current&&Object(H.a)(e)&&!n&&(a.current=e.current.scrollHeight,t(Object(b.g)(!0)))}(o,e,m,c),function(e,t,n){if(e){var a=Object(H.b)(e);a!==n.current&&(n.current=a,t(Object(b.l)(n.current)))}}(o,e,t)}),100),[m,e]),j=Object(i.useCallback)((function(t){return function(n){n.preventDefault(),e(Object(_.d)(t))}}),[e]);if(O>F.b)throw new Error(P.e.WS_RETRY_COUNT_EXCEEDED);return Object(r.e)(Se,{id:"conversation",role:"region","aria-label":"Conversation messages","data-testid":"conversation-component",onScroll:h,ref:o},Object(r.e)(re,null),Object(r.e)(ke,null,Object(r.e)(Xt,null),Object(r.e)(Yt,null),Object(r.e)($,{onClick:j}),Object(r.e)(ie.a,null)))})),Qt=n(61),$t=n.n(Qt),en=n(7),tn="".concat(en.a.chatApiUrl,"/attachments"),nn=function(){var e=Object(dt.a)(st.a.mark((function e(t){var n,a,r,i,o;return st.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.file,a=t.conversationId,!(n.size>1024e4)){e.next=3;break}throw new Error("File should be smaller than 10 MB");case 3:return(r=new URLSearchParams).append("filename",n.name),r.append("size",n.size.toString()),r.append("mimetype",n.type),r.append("conversationId",a),e.next=10,fetch(tn,{method:"POST",body:r});case 10:return i=e.sent,e.next=13,i.json();case 13:if(o=e.sent,i.ok){e.next=16;break}throw new Error;case 16:if(Ue()(o,"url")&&Ue()(o,"fields")){e.next=18;break}throw new Error;case 18:return e.abrupt("return",o);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),an=function(){var e=Object(dt.a)(st.a.mark((function e(t){var n,a,r,i,o,c,l,u,s,d=arguments;return st.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s in n=d.length>1&&void 0!==d[1]?d[1]:fetch,a=t.file,r=t.signedPostPolicy,i=t.errorMessage,o=r.url,c=r.fields,l=encodeURI(o+c.key),u=new FormData,c)u.append(s,c[s]);return u.append("Content-Type",a.type),u.append("file",a,a.name),e.prev=8,e.next=11,n(o,{method:"POST",body:u});case 11:if(e.sent.ok){e.next=14;break}throw new Error(i);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(8),new Error(i);case 19:return e.abrupt("return",l);case 20:case"end":return e.stop()}}),e,null,[[8,16]])})));return function(t){return e.apply(this,arguments)}}(),rn=n(123);function on(){var e=Object(O.a)(["\n    height: ","px;\n    width: 36px;\n    position: relative;\n\n    color: ",";\n\n    &:focus {\n        box-shadow: none;\n        i {\n            transform: translate(-50%, -50%) scale(1.1);\n            transform-origin: center right;\n        }\n    }\n\n    i {\n        font-size: 18px;\n        position: absolute;\n        left: 50%;\n        top: 50%;\n        transform: translate(-50%, -50%);\n    }\n"]);return on=function(){return e},e}var cn=Object(r.d)({width:"100%",display:"flex",overflowY:"auto",minHeight:"".concat(56,"px"),boxShadow:"-2px -4px 12px 1px rgba(109, 81, 81, 0.08)",background:"white"}),ln=Object(r.d)({paddingLeft:"20px",minHeight:"".concat(56,"px"),display:"flex",position:"relative",width:"100%",form:{display:"inline-block",width:"86%",margin:0}}),un=Object(r.d)({padding:"5px 0"}),sn=Object(r.d)({opacity:0,fontSize:"14px",marginTop:0,marginBottom:"-5px",paddingTop:"".concat(16,"px"),paddingBottom:"".concat(15,"px"),width:"96%",whiteSpace:"pre-wrap",wordWrap:"break-word",wordBreak:"break-word",overflow:"hidden"}),dn=Object(r.d)({boxSizing:"border-box",position:"absolute",top:0,paddingTop:"".concat(16,"px"),paddingBottom:"".concat(15,"px"),border:0,width:"79%",height:"95%",fontSize:"14px",overflow:"hidden",resize:"none",color:d.a.DarkGrey,":focus":{border:0,boxShadow:"none",outline:"none"},"::placeholder":{color:d.a.MediumGrey}}),pn=Object(j.a)(rn.a)(on(),56,(function(e){return e.disabled?e.theme.offlineColor:e.theme.conversationColor}));function bn(){var e=Object(O.a)(["\n    color: ",";\n    &:hover {\n        cursor: pointer;\n        color: ",";\n    }\n    &:active,\n    &:focus {\n        color: ",";\n    }\n"]);return bn=function(){return e},e}var fn=Object(j.a)(pn)(bn(),d.a.MediumGrey,(function(e){return e.disabled?d.a.MediumGrey:e.theme.conversationColor}),(function(e){return e.theme.conversationColor})),mn=Object(i.memo)((function(e){var t=e.getUploadUrl,n=void 0===t?nn:t,c=e.uploadFile,l=void 0===c?an:c,u=e.focusTextInput,s=Object(f.a)(),d=Object(f.b)((function(e){return[e.application.texts.messageError,e.application.credentials.conversationId,e.application.texts.actionPostbackError]})),p=Object(a.a)(d,3),m=p[0],O=p[1],g=p[2],h=Object(i.useState)(!1),j=Object(a.a)(h,2),x=j[0],v=j[1],y=o.a.useRef(null),w=function(){var e=Object(dt.a)(st.a.mark((function e(t){var r,i,o,c,d;return st.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),t.target.files){e.next=3;break}return e.abrupt("return");case 3:return r=Object(a.a)(t.target.files,1),i=r[0],mt.a.addBreadcrumb({message:"User tried to upload a file",data:{filename:i.name,size:i.size,mimetype:i.type}}),e.prev=5,e.next=8,n({file:i,conversationId:O});case 8:return o=e.sent,e.next=11,l({file:i,signedPostPolicy:o,errorMessage:m});case 11:c=e.sent,s(Object(_.b)([{url:c,contentType:i.type}])),s(Object(b.a)(P.b.ATTACHMENT_UPLOAD)),e.next=21;break;case 16:return e.prev=16,e.t0=e.catch(5),d=e.t0.message||g,s(Object(b.n)({text:d,type:P.c.WARNING,category:P.b.ATTACHMENT_UPLOAD,isOpen:!0})),e.abrupt("return");case 21:return e.prev=21,$t()(y,"current.value",""),v(!1),u(),e.finish(21);case 25:case"end":return e.stop()}}),e,null,[[5,16,21,25]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.e)(fn,{type:"button",onClick:function(){var e;return null===(e=y.current)||void 0===e?void 0:e.click()},disabled:x,"aria-label":"Upload an image"},x?Object(r.e)(Vt,null):Object(r.e)(Tt,{code:vt.CAMERA}),Object(r.e)("input",{"data-testid":"upload-image-input",css:{display:"none"},ref:y,type:"file",accept:"image/*",onChange:w}))})),On=Object(i.memo)((function(){var e=Object(i.useState)(""),t=Object(a.a)(e,2),n=t[0],o=t[1],c=Object(f.a)(),l=Object(i.useRef)(null),u=Object(f.b)((function(e){return[Object(W.a)(e),e.application.texts]})),s=Object(a.a)(u,2),d=s[0],p=s[1],b=Object(i.useCallback)((function(){l.current&&l.current.focus()}),[]),m=function(){mt.a.addBreadcrumb({message:"User tried to send a message",data:{message:n}}),c(Object(_.d)(n)),o(""),b()},O=Object(i.useCallback)((function(e){c(Object(z.m)(0)),d&&d.createdDatetime&&c(Object(z.g)(d.createdDatetime))}),[c,d]),g=!n,h=Object(r.e)(pn,{"aria-label":"Send message",disabled:g,type:"submit",onClick:m},Object(r.e)(Tt,{code:vt.PLANE}));return Object(r.e)("div",{"data-testid":"footer-component",css:cn},Object(r.e)("div",{css:ln},Object(r.e)("form",null,Object(r.e)("div",{css:un},Object(r.e)("pre",{css:sn},n+"\n"),Object(r.e)("textarea",{id:"message-input",ref:l,"data-testid":"message-input","aria-label":"Gorgias live chat message input",css:dn,placeholder:p.inputPlaceholder,value:n,onChange:function(e){return o(e.currentTarget.value)},onKeyPress:function(e){e.shiftKey||e.key!==P.a.Enter||(e.preventDefault(),n&&m())},onFocus:O,maxLength:5e3}))),g?Object(r.e)(mn,{focusTextInput:b}):h))})),gn=n(153),hn=n(152),jn=n(25);function xn(){var e=Object(O.a)(["\n    position: relative;\n    min-width: 48px;\n    min-height: 48px;\n    border-radius: 50%;\n    order: 1;\n\n    svg {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n    }\n\n    &:focus {\n        box-shadow: 0 0 3px 3px white;\n        outline: none;\n    }\n"]);return xn=function(){return e},e}function vn(){var e=Object(O.a)(["\n    box-shadow: 0 2px 23px 0px rgba(57, 57, 57, 0.26);\n    position: relative;\n    z-index: 2;\n    display: flex;\n    justify-content: space-between;\n    width: 100%;\n    padding-top: 26px;\n    padding-bottom: 20px;\n    padding-left: 20px;\n    padding-right: 20px;\n    box-sizing: border-box;\n    background-color: ",";\n    align-items: center;\n\n    .close-handle {\n        display: none;\n        cursor: pointer;\n\n        .widget-xs & {\n            display: block;\n        }\n    }\n\n    .header-group {\n        display: flex;\n    }\n"]);return vn=function(){return e},e}Object(r.d)({boxShadow:"0 2px 23px 0px rgba(57, 57, 57, 0.26)",position:"relative",zIndex:2,display:"flex",width:"100%",paddingTop:"26px",paddingBottom:"20px",paddingLeft:"20px",paddingRight:"20px",boxSizing:"border-box",background:d.a.Blue,alignItems:"center"});var yn=j.a.div(vn(),(function(e){return e.isChatOnline?e.theme.mainColor:e.theme.offlineColor})),wn=Object(j.a)(rn.a)(xn()),En=Object(r.d)({lineHeight:"12px",fontSize:"12px",padding:"4px 8px",borderRadius:"8px",background:"rgba(0,0,0,0.08)",marginTop:"8px"}),Cn=Object(r.d)({display:"flex",flexDirection:"column",alignItems:"flex-start",height:"100%",color:d.a.White,maxWidth:"240px",maxHeight:"120px",position:"relative"}),Sn=Object(r.d)({color:"white",fontSize:"13px",fontWeight:600,lineHeight:"16px",marginBottom:"4px"}),kn=Object(r.d)({color:"white",fontSize:"15px",lineHeight:"18px",overflow:"hidden",textOverflow:"ellipsis",maxHeight:"90px"}),An=Object(r.d)({marginRight:"15px",alignItems:"center",display:"flex",flexWrap:"nowrap"}),Tn=Object(r.d)({transition:"background 0.2s linear",position:"relative",borderRadius:"50%",backgroundSize:"100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",color:d.a.DarkGrey,display:"flex",alignItems:"center",justifyContent:"center",width:"40px",zIndex:2,"&:first-of-type , &:last-of-type":{zIndex:1},span:{background:d.a.Green}}),In=Object(r.d)(Tn,{span:{background:d.a.Orange}}),Rn=Object(r.d)({position:"absolute",width:"10px",height:"10px",bottom:"1px",right:"2px",borderRadius:"50%"}),Mn={small:"32px",medium:"40px",tall:"50px"},Dn=Object(i.memo)((function(e){var t=e.isActive,n=Object(f.b)((function(e){var t,n,a,r;return[e.application.settings.agents,null===(t=e.application.settings)||void 0===t||null===(n=t.decoration)||void 0===n?void 0:n.avatarType,null===(a=e.application.settings)||void 0===a||null===(r=a.decoration)||void 0===r?void 0:r.avatarTeamPictureUrl]})),o=Object(a.a)(n,3),c=o[0],l=o[1],u=o[2],s=Object(i.useCallback)((function(e,n){var a=c.length>2&&(0===n||n===c.length-1)?"small":1===c.length?"tall":2===c.length&&0===n?"small":"medium",i=Object.assign({backgroundColor:"rgba(0,0,0,0.2)",backgroundImage:"url('".concat(e.avatarUrl,"')"),width:Mn[a],height:Mn[a]},(0===n||n===c.length-1)&&c.length>1?{transform:"translateX(".concat(0===n?3:-3,"px)")}:{});return Object(r.e)("div",{key:n,style:i,css:t?Tn:In,"aria-label":"".concat(e.name," profile picture")},!e.avatarUrl&&Object(r.e)(Oe.a,{name:e.name}),Object(r.e)("span",{css:Rn}))}),[t,c.length]),d=Object(i.useMemo)((function(){return Object(r.e)("div",{css:t?Tn:In,style:{backgroundImage:"url('".concat(u,"')"),transform:"none",width:Mn.tall,height:Mn.tall},"aria-label":"Team avatar picture"},Object(r.e)("span",{css:Rn}))}),[u,t]);return Object(r.e)("div",{css:An},l===jn.b.TEAM_MEMBERS?c.map((function(e,t){return s(e,t)})):d)})),Gn=Object(i.memo)((function(){var e=Object(f.a)(),t=o.a.useState(""),n=Object(a.a)(t,2),i=n[0],c=n[1],l=Object(f.b)((function(e){var t,n;return{businessHours:e.application.settings.businessHours,texts:e.application.texts,isChatOnline:e.application.status.isChatOnline,areAgentsAvailable:e.application.status.areAgentsAvailable,introductionText:null===(t=e.application.settings.decoration)||void 0===t?void 0:t.introductionText,offlineIntroductionText:null===(n=e.application.settings.decoration)||void 0===n?void 0:n.offlineIntroductionText,name:e.application.settings.name}})),u=l.businessHours,s=l.texts,d=l.isChatOnline,p=l.areAgentsAvailable,m=l.introductionText,O=l.offlineIntroductionText,g=l.name;o.a.useEffect((function(){if(!d){var e=function(){var e=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.c,r=e.timezone,i=e.businessHours;if(!r||0===i.length||Object(gn.d)(e,n))return"";var o={inMinutes:function(e){return 1===e?t.backLabelBackInAMinute:t.backLabelBackInMinutes.replace("{value}",e.toString())},inHours:function(e){return 1===e?t.backLabelBackInAnHour:t.backLabelBackInHours.replace("{value}",e.toString())},inDays:function(e){return 1===e?t.backLabelBackTomorrow:t.backLabelBackInDays.replace("{value}",e.toString())}},c=n(r),l=Object(gn.c)({timezone:r,businessHours:i},n);if(!l)return"";var u=l.fromTime.split(":"),s=Object(a.a)(u,2),d=s[0],p=s[1],b=Object(gn.b)(c.day()),f=0;b===+l.day&&l.nextWeek?f=7:b<+l.day?f=+l.day-b:b>+l.day&&(f=+l.day+gn.a.SUNDAY-b);var m=c.clone().set("h",+d).set("minute",+p).add(f,"day"),O=m.diff(c,"minute"),g=c.clone().add(O,"minute").day()!==c.day(),h=O<1440;if(g&&h)return o.inDays(1);var j=O>=1440;return j?o.inDays(f):O>=60?o.inHours(Math.round(O/60)):o.inMinutes(O)}(u,s);c(e)};e();var t=setInterval(e,6e4);return function(){clearInterval(t)}}c("")}),[u,s,d]);var h=d?m:O;return Object(r.e)(yn,{isChatOnline:d,role:"region","aria-label":"Live chat window header"},Object(r.e)(wn,{"aria-label":"Close the chat window",className:"close-handle",onClick:function(){return e(Object(b.m)(!1))}},Object(r.e)(hn.a,null)),Object(r.e)("div",{className:"header-group"},Object(r.e)(Dn,{isActive:p&&d}),Object(r.e)("div",{css:Cn},g?Object(r.e)("h1",{css:Sn},g):null,Object(r.e)("h2",{css:kn},h||""),!d&&""!==i&&Object(r.e)("div",{css:En},i))))})),Nn={form:Object(r.d)({label:"email-capture-required__form",alignItems:"center",paddingBottom:"5px",display:"flex",flexDirection:"column",flexGrow:1}),container:Object(r.d)({display:"flex",flexGrow:1,flexDirection:"column",width:"100%"}),emailWrapper:Object(r.d)({label:"email-capture-required__email-wrapper",width:"100%",padding:"20px 0 0 0",borderBottom:"1px solid ".concat(d.a.LightGrey),flexGrow:0,input:{fontSize:"14px",boxSizing:"border-box",background:"none",padding:"10px 15px",borderRadius:"5px",border:"none",outline:"none",boxShadow:"none",height:"100%",width:"100%",color:d.a.DarkGrey,"&:focus":{boxShadow:"none",border:"none",outline:"none"},"&::placeholder":{color:d.a.Grey}}}),messageWrapper:Object(r.d)({width:"100%",padding:"0",flexGrow:1,display:"flex",flexDirection:"column",textarea:{flex:1,boxSizing:"border-box",resize:"none",fontSize:"14px",background:"none",padding:"10px 15px 10px 15px",borderRadius:"5px",border:"none",outline:"none",boxShadow:"none",height:"100%",width:"100%",color:d.a.DarkGrey,"&:focus":{boxShadow:"none",border:"none",outline:"none"},"&::placeholder":{color:d.a.Grey}}}),buttonWrapper:function(e){return function(t){return Object(r.d)({boxSizing:"border-box",width:"100%",padding:"20px 20px 13px 20px",flexGrow:0,display:"flex",justifyContent:"center",button:Object(r.d)({border:"none",borderRadius:"3px",color:"white",background:e?t.offlineColor:t.mainColor,textAlign:"center",fontSize:"14px",fontWeight:500,width:"100%",height:"50px","&:hover":{cursor:e?"auto":"pointer"},"&:focus":{boxShadow:"0 0 0 3px ".concat(Object(d.g)(t.mainColor)),outline:"none"}})})}}},Ln=Object(i.memo)((function(e){var t=e.afterSubmit,n=Object(f.a)(),o=Object(i.useRef)(null),c=Object(i.useRef)(null),l=Object(f.b)((function(e){return[e.application.texts.emailCaptureRequiredEmailPlaceholder,e.application.texts.emailCaptureRequiredMessagePlaceholder,e.application.texts.send,Ue()(e,"application.settings.quickReplies.replies",[])]})),u=Object(a.a)(l,4),s=u[0],d=u[1],p=u[2],b=u[3],m=Object(i.useState)(""),O=Object(a.a)(m,2),g=O[0],h=O[1],j=Object(i.useState)(""),x=Object(a.a)(j,2),v=x[0],y=x[1],w=function(e){var a,r;e&&e.preventDefault(),v.trim()&&(null===(a=o.current)||void 0===a?void 0:a.reportValidity())&&(null===(r=c.current)||void 0===r?void 0:r.reportValidity())&&(n(Object(_.d)(v,{capturedMail:g})),h(""),y(""),t())},E=v.trim(),C=Boolean(!g.trim()||!E),S=b.length>0;return Object(r.e)("form",{"data-testid":"require-email-capture-component",css:Nn.form,onSubmit:w},Object(r.e)("div",{css:Nn.container,role:"presentation",onKeyDown:function(e){if(e.key===P.a.Enter&&(e.ctrlKey||e.metaKey))return w(),!1},"data-testid":"require-email-capture-component-container"},Object(r.e)("div",{css:Nn.emailWrapper,className:"email-input-wrapper"},Object(r.e)("input",{type:"email",ref:o,placeholder:s,"aria-label":s,pattern:"^[\\w\\-\\+=']+[\\w\\.\\-\\+=']*@[\\w\\.\\-]+\\.\\w+$",onChange:function(e){h(e.target.value)},maxLength:320,required:!0})),Object(r.e)("div",{css:Nn.messageWrapper},Object(r.e)("textarea",{placeholder:d,"aria-label":!E&&S?"You can either write a message or leave this input blank and submit the form by choosing one of the following option":"Write your message",ref:c,onChange:function(e){y(e.target.value)},required:!0})),!E&&S&&Object(r.e)($,{onClick:function(e){return function(a){var r;a.preventDefault(),(null===(r=o.current)||void 0===r?void 0:r.reportValidity())&&(n(Object(_.d)(e,{capturedMail:g})),h(""),y(""),t())}},shouldDisplay:!0}),Object(r.e)("div",{css:Nn.buttonWrapper(C)},Object(r.e)("button",{"aria-label":"Submit the form",type:"submit",disabled:C},p))),Object(r.e)(ie.a,null))})),zn=function(){var e=Object(f.b)((function(e){return[e.user.email,e.application.settings.preferences.emailCaptureEnforcement,e.application.status.isChatOnline]})),t=Object(a.a)(e,3),n=t[0],r=t[1],c=t[2],l=Object(i.useState)(Boolean(n)),u=Object(a.a)(l,2),s=u[0],d=u[1],p=Object(i.useCallback)((function(){d(!0)}),[]);return function(e,t,n,a){if(Boolean(e)||a)return!1;switch(t){case jn.e.ALWAYS_REQUIRED:return!0;case jn.e.REQUIRED_OUTSIDE_BUSINESS_HOURS:return!n;case jn.e.OPTIONAL:default:return!1}}(n,r,c,s)?o.a.createElement(i.Fragment,null,o.a.createElement(Gn,null),o.a.createElement(Ln,{afterSubmit:p})):o.a.createElement(i.Fragment,null,o.a.createElement(Gn,null),o.a.createElement(G,{href:"#message-input"},"Go to message input"),o.a.createElement(Jt,null),o.a.createElement(On,null))},_n="/chat",Hn=function(e){var t=e.initialEntries,n=void 0===t?[_n]:t;return o.a.createElement(M.a,{initialEntries:n},o.a.createElement(M.c,null,o.a.createElement(M.b,{exact:!0,path:_n},o.a.createElement(zn,null))))},Bn=n(154);function Fn(){var e=Object(O.a)(["\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n    padding: 0 2em;\n    text-align: center;\n\n    i {\n        font-size: 4em;\n        color: ",";\n        .widget-xs & {\n            font-size: 7em;\n        }\n    }\n\n    button {\n        padding: 0.5rem 1rem;\n        background-color: ",";\n        border-radius: 5px;\n    }\n"]);return Fn=function(){return e},e}var Pn=j.a.div(Fn(),d.a.Orange,d.a.LightGrey),Wn=function(){var e=Object(f.b)((function(e){return e.application.texts.actionPostbackError}))||"An error occurred. Please retry.";return o.a.createElement(Pn,null,o.a.createElement(Tt,{code:vt.WARNING}),o.a.createElement("h5",{"aria-live":"assertive",role:"alert"},e),o.a.createElement(rn.a,{onClick:function(){return window.location.reload()}},"Reload the page"))},Un=function(e){var t=e.children;return o.a.createElement(Bn.a,{fallbackComponent:function(){return o.a.createElement(i.Fragment,null,o.a.createElement(Gn,null),o.a.createElement(Wn,null))}},t)},Vn=function(e,t,n){e&&!t&&n()},Zn=Object(i.memo)((function(e){var t=e.isOpen,n=e.hideIframe,o=e.reconnectWs,u=void 0===o?Vn:o,m=Object(c.a)(),O=Object(f.a)(),j=Object(i.useRef)(null),x=Object(i.useRef)(!1),v=Object(i.useContext)(l.FrameContext).document,y=Object(i.useState)(null),w=Object(a.a)(y,2),E=w[0],C=w[1],S=Object(f.b)((function(e){return[e.application.status.isConnected,e.application.credentials.accessToken]})),k=Object(a.a)(S,2),A=k[0],T=k[1];return Object(i.useEffect)((function(){t&&!T&&O(Object(p.d)())}),[O,T,t]),Object(i.useEffect)((function(){!x.current&&A&&(x.current=!0)}),[A]),Object(i.useEffect)((function(){u(x.current,A,(function(){return O(Object(b.d)())}))}),[O,u,A]),Object(i.useEffect)((function(){t&&setTimeout((function(){j.current&&j.current.focus()}),100)}),[t]),Object(i.useEffect)((function(){!E&&v&&(C(Object(s.a)({key:"message-window-iframe",container:v.head})),function(e){var t=g.a.replace(/aria-label/g,"data-balloon-content"),n=e.createElement("style");n.setAttribute("data-testid","balloon-styles"),n.innerHTML="".concat(d.c," ").concat(t," ").concat(h.a," ").concat(d.b),e.head.appendChild(n);var a=e.createElement("title");a.innerText="Gorgias live chat window",e.head.appendChild(a)}(v))}),[E,v]),E&&Object(r.e)(r.a,{value:E},Object(r.e)(r.b,{styles:d.e}),Object(r.e)(R,{ref:j,className:"widget-".concat(m),isOpen:t,onAnimationEnd:n,tabIndex:0,"aria-label":"Chat conversation window",role:"region"},Object(r.e)(Un,null,Object(r.e)(Hn,null))))})),Yn=function(e){var t=e.isOpen,n=Object(i.useState)(t),o=Object(a.a)(n,2),l=o[0],u=o[1],s=Object(c.a)();Object(i.useEffect)((function(){t&&u(!0)}),[t]);var d=Object(i.useCallback)((function(){t||u(!1)}),[t]);return Object(r.e)(A,{id:"chat-window",title:"Gorgias live chat window",size:s,shouldRender:l},Object(r.e)(Zn,{isOpen:t,hideIframe:d}))};t.default=Object(i.memo)(Yn)}}]);